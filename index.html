<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>InnovaTrack</title>
<style>
body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #fff; }
nav { background: #16a34a; color: white; padding: 10px 20px; }
nav h1 { margin: 0; font-size: 20px; }
.container { max-width: 600px; margin: 20px auto; padding: 10px; }
input { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; border: 1px solid #ccc; border-radius: 5px; }
button { padding: 10px; margin-top: 5px; background: #16a34a; color: white; border: none; border-radius: 5px; cursor: pointer; }
button:hover { background: #15803d; }
.grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; margin-top: 10px; }
.seat { padding: 8px; border: 1px solid #16a34a; border-radius: 5px; text-align: center; }
.occupied { background: #16a34a; color: white; }
.login { max-width: 300px; margin: 50px auto; text-align: center; }
</style>
</head>
<body>

<div id="app"></div>

<script>
const students = {
  1: 'Alice', 2: 'Bob', 3: 'Charlie', 4: 'David', 5: 'Eva',
  6: 'Fiona', 7: 'George', 8: 'Hannah', 9: 'Ian', 10: 'Julia',
  11: 'Kevin', 12: 'Lara', 13: 'Mona', 14: 'Nathan', 15: 'Olivia',
  16: 'Peter', 17: 'Quinn', 18: 'Rachel', 19: 'Sam', 20: 'Tina',
  21: 'Uma', 22: 'Victor', 23: 'Wendy', 24: 'Xander', 25: 'Yara',
  26: 'Zane', 27: 'Amy', 28: 'Brian', 29: 'Cathy', 30: 'Derek'
};

const today = new Date().toLocaleDateString();
let seatData = [];
let isAuthenticated = false;

function initSeats() {
  const savedDate = localStorage.getItem('attendanceDate');
  if (savedDate !== today) {
    seatData = Array.from({ length: 30 }, (_, i) => ({ number: i + 1, occupied: false }));
    localStorage.setItem('attendanceDate', today);
    localStorage.setItem('seatData', JSON.stringify(seatData));
  } else {
    const savedSeats = JSON.parse(localStorage.getItem('seatData') || '[]');
    seatData = savedSeats.length ? savedSeats : Array.from({ length: 30 }, (_, i) => ({ number: i + 1, occupied: false }));
  }
}

function saveSeats() {
  localStorage.setItem('seatData', JSON.stringify(seatData));
}

function renderLogin() {
  document.getElementById('app').innerHTML = `
    <div class="login">
      <h1>InnovaTrack Login</h1>
      <input id="username" type="text" placeholder="Username">
      <input id="password" type="password" placeholder="Password">
      <button id="loginBtn">Login</button>
    </div>
  `;
  document.getElementById('loginBtn').onclick = handleLogin;
}

function renderSeatPlan() {
  let gridHTML = seatData.map(seat => `
    <div class="seat ${seat.occupied ? 'occupied' : ''}">
      ${seat.number} - ${seat.occupied ? seat.student : students[seat.number] || ''}
    </div>
  `).join('');

  document.getElementById('app').innerHTML = `
    <nav><h1>InnovaTrack</h1></nav>
    <div class="container">
      <h2>Seat Plan (Manual Input)</h2>
      <input id="manualInput" type="text" placeholder="Enter seat number manually">
      <button id="markSeatBtn">Mark Seat</button>
      <button id="printDownloadBtn">Print & Download Seat Data</button>
      <div class="grid">${gridHTML}</div>
    </div>
  `;

  document.getElementById('markSeatBtn').onclick = handleManualSubmit;
  document.getElementById('printDownloadBtn').onclick = handlePrintAndDownload;
}

function handleLogin() {
  const username = document.getElementById('username').value;
  const password = document.getElementById('password').value;
  if (username === 'marvin' && password === 'grafil') {
    isAuthenticated = true;
    renderSeatPlan();
  } else {
    alert('Incorrect username or password.');
  }
}

function handleManualSubmit() {
  const input = document.getElementById('manualInput').value;
  const seatNumber = parseInt(input.replace(/[^0-9]/g, ""));
  if (!isNaN(seatNumber) && seatNumber >= 1 && seatNumber <= 30) {
    const studentName = students[seatNumber] || "Unknown";
    const timestamp = new Date().toLocaleTimeString();
    seatData = seatData.map(seat => seat.number === seatNumber ? { ...seat, occupied: true, student: studentName, timestamp, date: today } : seat);
    saveSeats();
    document.getElementById('manualInput').value = '';
    renderSeatPlan();
  } else {
    alert('Invalid seat number.');
  }
}

function handlePrintAndDownload() {
  let html = `<h2>Seat Plan</h2><p>Date: ${today}</p>`;
  html += '<table border="1" style="border-collapse: collapse; width: 100%">';
  html += '<tr><th>Seat Number</th><th>Name</th><th>Timestamp</th><th>Date</th></tr>';
  seatData.forEach(seat => {
    const name = seat.occupied ? seat.student : students[seat.number] || '';
    const timestamp = seat.occupied ? seat.timestamp : 'Absent';
    const date = seat.occupied ? seat.date : today;
    html += `<tr><td>${seat.number}</td><td>${name}</td><td>${timestamp}</td><td>${date}</td></tr>`;
  });
  html += '</table>';

  const printWindow = window.open('', '', 'height=600,width=800');
  printWindow.document.write(html);
  printWindow.document.close();
  printWindow.print();

  const blob = new Blob([html], { type: 'text/html' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'seat_data.html';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

initSeats();
renderLogin();
</script>

</body>
</html>
