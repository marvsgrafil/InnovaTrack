<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>InnovaTrack</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0fff0;
      margin: 0;
      padding: 0;
    }
    nav {
      background-color: green;
      color: white;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .login-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-color: #e6f7e6;
    }
    .login-container input {
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      width: 16rem;
      color: black;
    }
    button {
      background-color: green;
      color: white;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: darkgreen;
    }
    .seat-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 0.5rem;
    }
    .seat {
      padding: 0.5rem;
      border: 1px solid #000;
      border-radius: 0.25rem;
      text-align: center;
    }
    .seat.occupied {
      background-color: green;
      color: white;
    }
    th {
      padding: 4px;
    }
  </style>
</head>
<body>

  <!-- Login -->
  <div id="loginPage" class="login-container">
    <h1 style="font-size:2rem; color:green; margin-bottom:1rem;">InnovaTrack Login</h1>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="handleLogin()">Login</button>
  </div>

  <!-- Main App -->
  <div id="appPage" style="display:none;">
    <nav>
      <h1>InnovaTrack</h1>
    </nav>
    <div style="padding:1rem;">
      <h2 style="font-size:1.5rem; font-weight:bold; color:green; margin-bottom:1rem;">Seat Plan (Manual Input)</h2>
      
      <form onsubmit="handleManualSubmit(event)" style="display:flex; gap:0.5rem; margin-bottom:1rem;">
        <input type="text" id="manualInput" placeholder="Enter seat number manually" style="flex:1; padding:0.5rem; border:1px solid #000; border-radius:0.25rem;">
        <button type="submit">Mark Seat</button>
      </form>

      <button onclick="handlePrintAndDownload()" style="margin-bottom:1rem;">Print Attendance</button>

      <div id="seatGrid" class="seat-grid"></div>
    </div>
  </div>

  <script>
    const students = {
      1: 'Rosa', 2: 'Bob', 3: 'Charlie', 4: 'David', 5: 'Eva',
      6: 'Fiona', 7: 'George', 8: 'Hannah', 9: 'Ian', 10: 'Julia',
      11: 'Kevin', 12: 'Lara', 13: 'Mona', 14: 'Nathan', 15: 'Olivia',
      16: 'Peter', 17: 'Quinn', 18: 'Rachel', 19: 'Sam', 20: 'Tina',
      21: 'Uma', 22: 'Victor', 23: 'Wendy', 24: 'Xander', 25: 'Yara',
      26: 'Zane', 27: 'Amy', 28: 'Brian', 29: 'Cathy', 30: 'Derek'
    };

    const today = new Date();
    const todayString = today.toLocaleDateString();
    const monthYear = today.toLocaleString('default', { month: 'long', year: 'numeric' });

    let seatData = [];
    let seatHistory = JSON.parse(localStorage.getItem('seatHistory') || '{}');

    function initSeats() {
      if (!seatHistory[todayString]) {
        seatData = Array.from({ length: 30 }, (_, i) => ({ number: i + 1, occupied: false }));
        seatHistory[todayString] = seatData;
        localStorage.setItem('seatHistory', JSON.stringify(seatHistory));
      } else {
        seatData = seatHistory[todayString];
      }
      renderSeats();
    }

    function saveSeats(updatedSeats) {
      seatData = updatedSeats;
      seatHistory[todayString] = updatedSeats;
      localStorage.setItem('seatHistory', JSON.stringify(seatHistory));
      renderSeats();
    }

    function handleLogin() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      if (username === 'marvin' && password === 'grafil') {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('appPage').style.display = 'block';
        initSeats();
      } else {
        alert('Incorrect username or password.');
      }
    }

    function handleManualSubmit(e) {
      e.preventDefault();
      const manualInput = document.getElementById('manualInput').value;
      const seatNumber = parseInt(manualInput.replace(/[^0-9]/g, ''));
      if (!isNaN(seatNumber)) {
        const studentName = students[seatNumber] || 'Unknown';
        const timestamp = new Date().toLocaleTimeString();
        const updatedSeats = seatData.map(seat => 
          seat.number === seatNumber ? { ...seat, occupied: true, student: studentName, timestamp, date: todayString } : seat
        );
        saveSeats(updatedSeats);
        document.getElementById('manualInput').value = '';
      }
    }

    function renderSeats() {
      const seatGrid = document.getElementById('seatGrid');
      seatGrid.innerHTML = '';
      seatData.forEach(seat => {
        const div = document.createElement('div');
        div.className = 'seat' + (seat.occupied ? ' occupied' : '');
        div.innerText = seat.number + ' - ' + (seat.occupied ? seat.student : (students[seat.number] || ''));
        seatGrid.appendChild(div);
      });
    }

    function handlePrintAndDownload() {
      let content = '<html><head><title>Monthly Attendance Sheet</title></head><body>';
      content += `<h2 style="text-align:center;">Monthly Class Attendance</h2>`;
      content += `<p>Month/Year: ${monthYear}</p>`;
      content += "<table border='1' style='border-collapse:collapse; width:100%; text-align:center'>";
      
      // Header Row with weekdays only
      content += "<tr><th>ID</th><th>Name</th>";
      const year = today.getFullYear();
      const month = today.getMonth();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      let weekdays = [];
      for (let day = 1; day <= daysInMonth; day++) {
        let d = new Date(year, month, day);
        let dayName = d.toLocaleDateString('en-US', { weekday: 'short' });
        if (dayName !== "Sat" && dayName !== "Sun") {
          let key = new Date(year, month, day).toLocaleDateString();
          weekdays.push({ day, dayName, key });
          content += `<th>${day}<br>${dayName}</th>`;
        }
      }
      content += "</tr>";

      // Rows for students
      for (let i = 1; i <= 30; i++) {
        content += `<tr><td>${i}</td><td>${students[i] || ''}</td>`;
        weekdays.forEach(({ key }) => {
          let status = '';
          if (seatHistory[key]) {
            let seat = seatHistory[key].find(s => s.number === i);
            if (seat?.occupied) {
              status = 'P';
            } else {
              status = 'A';
            }
          }
          content += `<td>${status}</td>`;
        });
        content += "</tr>";
      }

      content += '</table>';
      content += '<p>Legend: P = Present, L = Late, A = Absent</p>';
      content += '</body></html>';

      const printWindow = window.open('', '', 'height=600,width=800');
      printWindow.document.write(content);
      printWindow.document.close();
      printWindow.print();
    }
  </script>
</body>
</html>

